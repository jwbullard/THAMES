# Description of the DBR_DAT file format and example of the input DBR_DAT file

# GEMIPM2K v. 0.98
# Prototype 12.12.2006
# Comment lines are marked with '#' and will be ignored when reading the file

# This is a DBR_DAT text input file initially generated by the GEMS-PSI GEM2MT module 
# One or more DBR_DAT files should be be read after the DCH_DAT and IPM-DAT files. 

# This file (read into the DATABR memory structure of GEMIPM2K) describes properties of the local-equilibrium 
# node that should be exchanged between the coupled FMT and GEM parts. The data exchange occurs via the DATABR 
# memory structure which is the main "data bridge" interface for coupling mass transport and chemistry 
# (see also DATABR.H file).
# The DBR_DAT file and DATABR structure contain parts of the chemical system definition (CSD) that may be changed 
# by the FMT part (input data of GEM such as T, P, bulk composition, metastability constraints) or are returned 
# after the GEM IPM calculation and can be utilized by the FMT part in the next time iteration loop (pH, pe, 
# speciation, chemical potentials, bulk composition of aqueous or gas phase, etc.).

# The DBR_DAT text input file consists of several logical sections. Dimesions of all data objects in DBR_DAT files 
# are set in Section (2) of the DCH_DAT file (see dch-dat-doc.txt file). The the order of components and phases 
# is defined by the index lists 'xIC', 'xDC', 'xPH' in Section (4) of the DCH_DAT file; the indexes, in turn, 
# in turn, refer to the name lists 'ICNL, 'DCNL' and 'PHNL' in that file. 

# Here, we will refer to tags from the DCH_DAT file data objects even though these tags are not present in the 
# DBR_DAT file; we assume that the DATACH structure exists in memory and is correctly filled out (e.g. by reading 
# the DCH_DAT file) before any operation with DBR_DAT files or DATABR memory structures. 

# Data objects, each consisting from a tag (a name in angle brackets <> and one or more values following the tag)
# can occur in an arbitrary order, although it is recommended to arrange input data objects in the order shown below.  
# Some data objects can be skipped from the input DBR_DAT file; in this case, their elements will be automatically 
# assigned default values. Data objects that cannot be skipped are marked with '***'. All data objects will be 
# printed in the DBR_DAT file from GEMS or GEMIPM2K program. 

# The actual values and numbers in this DBR_DAT file description are related to a particular example of the 
# chemical system, the same as in the companion dch-dat-doc.txt and ipm-dat-doc.txt files, and are given for 
# illustration purposes. The numbers and name lists may change if a different CSD is constructed. 

## Section (1): controls of the GEM IPM operation and data exchange.
# Node identification handle. Not used on TNode level; in TNodeArray, the node absolute index should be kept here 
# (it can be used in diagnostic messages and output files). Default value: 0.
<NodeHandle>     0

# Node type code (hydraulic). Not used on TNode level; in TNodeArray, one of the codes given in typedef NODETYPE 
# in DATABR.H must be given here ( to be described in more detail). Default value: 0.
<NodeTypeHY>     0

# Node type (mass transport). Not used on TNode level; in TNodeArray, one of the codes given in typedef NODETYPE 
# in DATABR.H must be given here ( to be described in more detail). Default value: 0.
<NodeTypeMT>     0

# Node status code in FMT. Not used on TNode level; in TNodeArray, one of the codes given in typedef NODECODEFMT 
in DATABR.H must be given here (to be described in more detail). Default value: 1.
<NodeStatusFMT>  1

# *** Node status code in GEM (input and output); see typedef NODECODECH in the DATABR.H. This code sets the mode 
# of operation of GEMIPM and returns how GEM has converged (at GEM output). If GEMIPM calculation is called when 
# in the DATABR structure this code is set to 1 then the simplex automatic initial approximation will be used. 
# This results in a larger number of GEM IPM iterations (typically between 20 and 100) but guarantees that the 
# correct stable phase assemblage will be found. Alternatively, setting the code to 5 causes GEM IPM to use 
# the available GEM solution (vectors 'xDC' and 'gam' in this file) as the initial approximation. This dramatically
# reduces the number of iterations (typically to 1 - 5) but does not guarantee that the possible appearance of a 
# new phase (e.g. upon change of T or bulk composition) will be detected. The normal return codes for both modes
# are, respectively, 2 and 6. It is advisable for the FMT program part to check these codes in this field before
# continuing because any other code value except 1,2 and 5,6 signals an error in GEM calculation (see NODECODECH
# in DATABR.H for details). Please, note that, if the return code 2 or 6 is left unchanged in the DATABR structure
# and GEM calculation is called then nothing will be done and the control will be returned with the code unchanged.       
<NodeStatusCH>   1

# Number of iterations performed by GEM IPM (output): here GEM IPM returns how many iterations were done during 
# the last actual calculation (i.e. invoked by codes 1 or 5 in <NodeStatusCH> field. This data object is not used 
# for GEM input. 
<IterDone>       34

## Section (2): Chemical scalar variables
# *** Node Temperature T, C (GEM input). This value must always be provided. If this value differs by more than 
# <Ttol> degrees from the temperature value used in previous GEM calculation, the GEMIPM2K program will first attempt
# to interpolate thermodynamic data (if interpolation grid arrays were provided in DCH_DAT file or DATACH memory
# structure). If a given <TC> value goes beyond the interpolation interval, it will be automatically replaced by 
# the closest available temperature from the interpolation range (this can be checked in this data object after
# GEMIPM returns control or writes the DBR_DAT file). 
<TC>    25

# *** Node Pressure P, bar (GEM input). This value must always be provided. If this value differs by more than 
# <Ptol> bar from the pressure value used in previous GEM calculation, the GEMIPM2K program will first attempt
# to interpolate thermodynamic data (if interpolation grid arrays were provided in DCH_DAT file or DATACH memory
# structure). If a given <P> value goes beyond the interpolation interval, it will be automatically replaced by 
# the closest available pressure from the interpolation range (this can be checked in this data object after
# GEMIPM returns control or writes the DBR_DAT file).
<P>    1

# Volume V of reactive subsystem in the node, m3 (GEM output)
<Vs>   9.99944e-4

# Volume of inert subsystem, m3 (used only in FMT part and stored here on the TNodeArray level).
<Vi>   0

# Mass of reactive subsystem, kg (GEM output). Will be automatically calculated from the input bulk composition
# vector <bIC> using the <ICmm> vector. Dividing <Ms> by <Vs> gives the mean density of the reactive part in kg/m3. 
<Ms>   0.997033

# Mass of inert subsystem, kg (used only in FMT part and stored here on the TNodeArray level).
<Mi>   0

# Total Gibbs energy of the reactive subsystem, J/RT (normalized), GEM output
<Gs>   -5295.11

# Total enthalpy of reactive subsystem, J (reserved)
<Hs>   0

# Total enthalpy of inert subsystem, J (reserved, can be used only in FMT part) 
<Hi>   0

# Effective aqueous ionic strength, molal (GEM output)
<IS>   0.000385368

# pH of aqueous solution (GEM output)
<pH>   9.90998

# pe of aqueous solution (GEM output) 
<pe>   10.3367

# Eh of aqueous solution, V (GEM output)
<Eh>   0.610284

## Section (3): FMT scalar variables (not used on the level of TNode, stored in DATABR structures and files
## on the level of TNodeArray). Default values are all zeros. 
# Actual total simulation time, s
<Tm>   0

# Actual time step, s
<dt>   0

# General diffusivity of disolved matter in the node, m2/s 
<Dif>  0

# Total volume of the node, m3
<Vt>   0

# Advection velocity (in pores) in this node, m/s
<vp>   0

# Effective (actual) porosity normalized to 1
<eps>  0

# Actual permeability, m2 
<Km>   0

# Actual Darcy`s constant, m2/s
<Kf>   0

# Specific storage coefficient, dimensionless 
<S>    0

# Transmissivity, m2/s
<Tr>   0

# Actual hydraulic head (hydraulic potential), m
<h>    0

# Actual carrier density for density-driven flow, kg/m3
<rho>  0

# Specific longitudinal dispersivity of porous media, m
<al>   0

# Specific transversal dispersivity of porous media, m
<at>   0

# Specific vertical dispersivity of porous media, m
<av>   0

# Hydraulic longitudinal dispersivity, m2/s
<hDl>  0

# Hydraulic transversal dispersivity, m2/s
<hDt>  0

# Hydraulic vertical dispersivity, m2/s
<hDv>  0

# Tortuosity factor
<nto>  0

### Arrays:
## Section (4) - data for Independent Components:
# *** Bulk composition of (reactive part of) the system - GEM input (amounts of IC in moles). This vector has <nICb>
# elements; order of IC: defined in  the <xIC> index list. All numbers in <bIC> must be positive, between 1e-16 and 
# 9.9999e+5 mol, except the last number (for the charge balance) which is usually set to zero. 
# This vector is the main input of GEM IPM. Inconsistent data in <bIC> may cause bad convergence or failure of 
# the GEM IPM calculation. This vector is at least slightly changed after the mass transport step and must always 
# be provided at GEM input. 
<bIC>
3.31e-04 3.31e-04 2.0e-07 1.106837e+02 1.0e-07 5.534286e+01 0.0e+00 

# Mass balance residuals - GEM output (moles). This vector has <nICb> elements in the order of IC defined in the <xIC> 
# index list. Good mass balance residuals must be less than 1e-7 mol or < 0.1% of the respective element of the total 
# bulk composition <bIC> which is less than 1e-7. This vector can be checked for evaluating the quality of the
# GEM IPM-2 solution. At GEM input, this vector is irrelevant (????????????? maybe use it for setting MB precision?). 
<rMB>
2.77121e-10 -1.28589e-10 -2.50312e-10 -8.197958e-10 5.59653e-10 -7.62758e-10 -4.17019e-10 

# Chemical potentials of ICs (dual GEM solution) - GEM output, normalized scale (input in the old GEM solution as 
initial approximation mode, <NodeStatusCH> = 5). This vector has <nICb> elements, in the order defined in the <xIC> 
# index list. 
# This vector contains normalized chemical potentials of Independent Components, from which and the stoichiometry matrix
# <A> the chemical potential of any DC in this chemical system can be algebraically calculated. Usage of dual GEM 
# solution may lead to innovative and powerful new coupling schemes between FMT and chemistry. 
<uIC>
-1.684504e+02 -2.797380e+02 -4.4603514e+01 -4.661977e+01 -2.470017e+02 -2.437813e+00 2.380119e+01 

## Section (5) - data for Dependent Components:
# Speciation - amounts of DCs in equilibrium state - primal GEM solution (GEM output), moles. 
# This vector is also required as input at <NodeStatusCH> = 5 when the old GEM solution is used as an initial 
# approximation. Number of elements: <nDCb>; order of DC is defined in the <xDC> index list in the DATACH structure.
# The <xDC> vector is the standard result of equilibrium speciation calculations, from which concentrations of all 
# chemical species (or their activities using the <gam> output vector) can be computed. Zeros in this vector 
# correspond to unstable species eliminated by GEM from the equilibrium state. 
<xDC>
1.1662199e-04 9.4209854e-08 3.3800033e-05 8.2943335e-05 2.002503e-07 8.295096e-05 1.2555821e-10 
5.5341765e+01 2.085901e-04 0.0e+00 

# Activity coefficients of DCs in their respective phases - GEM output.
# This vector is also required as input at <NodeStatusCH> = 5 when the old GEM solution is used as an initial 
# approximation. Number of elements: <nDCb>; order of DC is defined in the <xDC> index list in the DATACH structure.
# Trivial (default) value: 1.0. Activity coefficient multiplied by species concentration in the respective 
# phase yields primal activity of this chemical species. 
<gam>
9.1380663e-01 9.1380663e-01 9.1380663e-01 9.777179e-01 9.777179e-01 9.777179e-01 9.777179e-01 
1.00e+00 1.0e+00 1.0e+00 

# Lower metastability constraints on amounts of DCs - GEM input, moles. Number of elements: <nDCb>; order: 
# defined in the <xDC> index list in the DATACH file/structure. Trivial (default) value: 0 moles.
# This input vector allows the simulation of various kinetic controls, e.g. dissolution kinetics, as function 
# of time and solution composition. In this case, great care should be taken to ensure consistent values of these
# constraints; inconsistent (too large) values may cause the program crash or convergence failure. 
<dll>
0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 0.0e+00 

# Upper metastability constraints on amounts of DCs - GEM input, moles. Number of elements: <nDCb>; order: 
# defined in the <xDC> index list in DATACH file/structure. Trivial (default) value: 1.0e+06 moles.
# This input vector allows the simulation of various kinetic controls, e.g. precipitation kinetics, 
# as function of time and solution composition.
<dul>
1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 1.0e+06 

## Section (6) - data for Phases:
# Specific surface areas of phases (m2/g) - GEM input. Number of elements: <nPHb>; order of phases: 
# defined in <xPH> index list in the DATACH file/structure. This vector should be provided only if 
# the <fAalp> = 1 in the DATACH file, otherwise the data will be ignored. Default values: 0 m2/g. 
<aPH>
0.0e+00 0.0e+00 0.0e+00 

# Amounts of phases in equilibrium state - GEM output (moles). Number of elements: <nPHb>; order: defined 
# in the <xPH> index list in the DATACH file/structure. Zero element value means that the respective phase 
# is unstable and is not present in the equilibrium state. This data object is not used as GEM IPM input.  
<xPH>
5.534209756e+01 2.0859011268e-04 0.0e+00 

# Volumes of multicomponent phases (cm3), GEM output. Number of elements: <nPSb>; order of phases: 
# defined in the <xPH> index list in the DATACH file/structure.
<vPS>
9.99936471e+02  

# Masses of multicomponent phases (g), GEM output. Number of elements: <nPSb>; order of phases: defined 
# in the <xPH> index list in the DATACH file/structure.
# The density of a multicomponent phase can be obtained as <mPS>/<vPS> in g/cm3. 
<mPS>
9.97012581e+02 

# Bulk elemental compositions of multicomponent phases - GEM output, moles. Number of elements: <nPSb>*<nICb>; 
# order of phases ( <nPSb> rows): defined in <xPH> index list in the DATACH file/structure; order of ICs ( <nICb> 
# columns): defined in the <xIC> index list in DATACH. 
# The whole row of zeros means that the respective phase is not present in the equilibrium state.
# This GEM output table is important for the FMT part because it contains the bulk composition of fluid 
# phase(s) changed after equilibration in the node. In the example below, the <bPS> object has only one row.
<bPS>
1.2240959856e-04 1.2241000427e-04 2.0025031458e-07 1.106836964e+02 9.944034855e-08 5.5342235439e+01 4.170187181e-10 

# Amount of carrier (sorbent or solvent) in multicomponent phases (GEM output). Number of elements: <nPSb>; 
# order of phases: defined in <xPH> index list in the DATACH file/structure. This data object may be very useful 
# e.g. in calculation of molal concentrations of aqueous species. 
<xPA>
5.534176513e+01 

# End of dbr-dat-doc.txt file
